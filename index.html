<!-- ============================
File: dashboard.html
Compact SPA tabs (Profile, Jobs, Applications, Saved, Manage Posts, Settings)
Smoother dark mode, persistent theme toggle, Supabase guard, mobile polish.
============================ -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>User Dashboard ‚Ä¢ CaribCareerHub</title>

  <style>
    /* Light */
    :root{
      --bg:#F3F8FF; --panel:#ffffff; --ink:#0A2458; --muted:#6B7A99;
      --brand:#1E6CFF; --brand-2:#3FA2FF; --accent:#FFA03B;
      --radius:18px; --shadow:0 10px 30px rgba(16,40,120,.12); --ring:0 0 0 3px rgba(30,108,255,.14);
      --line: color-mix(in oklab, var(--ink) 12%, transparent);
    }
    /* Dark (same feel as homepage) */
    body.dark{
      --bg:#0b1220; --panel:#121a2b; --ink:#eaf0ff; --muted:#a7b3cc;
      --brand:#5a8fff; --brand-2:#8ec4ff; --accent:#ffb86c;
      --shadow:0 16px 44px rgba(0,0,0,.5); --ring:0 0 0 3px rgba(142,196,255,.22);
      --line: color-mix(in oklab, var(--ink) 18%, transparent);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }

    /* Header (center brand, small right tools) */
    .header{max-width:1100px;margin:16px auto 0;padding:0 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .brand .logo{width:80px;height:80px;object-fit:contain}
    .brand-name{font-weight:900;letter-spacing:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .tools{display:flex;align-items:center;gap:8px}
    .btn, .chip{
      border:none;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer;
    }
    .chip{background:var(--panel);border:1px solid var(--line);color:var(--ink)}
    .chip:focus{outline:none;box-shadow:var(--ring)}
    .theme-toggle{line-height:1}
    .logout{background:linear-gradient(90deg,#ff6961,#ff8b86);color:#fff}

    /* Layout */
    .dashboard{max-width:1100px;margin:16px auto 40px;padding:0 16px;display:flex;gap:16px}
    .glass{background: color-mix(in oklab, var(--panel) 92%, transparent); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter: blur(12px)}
    .sidebar{width:220px;flex:0 0 220px;padding:12px}
    .side-title{margin:2px 0 10px 6px;font-size:13px;font-weight:900;opacity:.9}
    .tabs{display:flex;flex-direction:column;gap:8px}
    .tab-link{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;text-decoration:none;color:var(--ink);font-weight:800;border:1px solid transparent;min-height:42px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .tab-link .i{width:22px;text-align:center}
    .tab-link:hover{border-color:var(--line)}
    .tab-link.active{background: color-mix(in oklab, var(--brand) 18%, transparent); border-color: color-mix(in oklab, var(--brand) 40%, transparent); box-shadow: var(--ring)}

    .side-row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:10px}
    .theme-label{font-weight:900}
    .main{flex:1;padding:16px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:12px 14px}
    .user-menu{display:flex;align-items:center;gap:10px;font-weight:800}
    .user-menu img{width:36px;height:36px;border-radius:50%}
    .content{margin-top:14px}
    .card{padding:18px 20px;margin-bottom:14px}

    /* Units */
    .input input, .input select, .input textarea{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:transparent;color:var(--ink);font:16px/1.4 inherit
    }
    .row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:start;padding:14px 16px}
    .row h4{margin:0 0 2px;font-size:18px}
    .meta{color:var(--muted);font-size:14px;margin:0}
    .save-btn{background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted)}
    .save-btn.saved{color:var(--accent)}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:900}
    .b-applied{background:color-mix(in oklab,var(--brand) 22%, transparent);color:var(--ink)}
    .b-interview{background:color-mix(in oklab,#ffd600 30%, transparent);color:#1f1f1f}
    .b-offer{background:color-mix(in oklab,#59d985 30%, transparent);color:#0b2a16}
    .b-rejected{background:color-mix(in oklab,#ff5a5a 28%, transparent);color:#fff}
    .wrap{word-break:break-word;overflow-wrap:anywhere}

    /* Modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000}
    .backdrop.open{display:flex}
    .modal{width:min(92vw,720px)}
    .modal .head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
    .modal .title{margin:0;font-size:18px;font-weight:900}
    .modal .close{border:1px solid var(--line);background:transparent;border-radius:10px;padding:6px 10px;cursor:pointer}
    .grid{display:grid;gap:10px}
    .grid.two{grid-template-columns:1fr 1fr}
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    .btn-primary{color:#fff;background:linear-gradient(90deg,var(--brand),var(--brand-2))}
    .btn-line{background:transparent;border:1px solid var(--line);color:var(--ink)}
    .note{margin:6px 0 0;color:var(--muted)}
    .ok{color:#2ad06f}.err{color:#ff6b6b}

    /* Mobile */
    @media (max-width:960px){ .dashboard{flex-direction:column} .sidebar{width:100%;flex:none} }
    @media (max-width:420px){ .tab-link{padding:9px 10px;font-size:14px} .brand .logo{width:70px;height:70px} .brand-name{font-size:20px;letter-spacing:3px} }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="brand">
      <img src="./assets/logo.svg" alt="CaribCareerHub logo" class="logo" />
      <div class="brand-name">CARRIBCAREERHUB</div>
    </div>
    <div class="tools">
      <button id="themeToggle" class="chip theme-toggle" aria-label="Toggle theme">üåô</button>
      <button id="logoutBtn" class="btn logout" title="Log out">Log out</button>
    </div>
  </header>

  <!-- App Layout -->
  <main class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar glass">
      <p class="side-title">Dashboard</p>
      <nav class="tabs">
        <a href="#" class="tab-link active" data-tab="profile"><span class="i">üë§</span><span>Profile</span></a>
        <a href="#" class="tab-link" data-tab="jobs"><span class="i">üíº</span><span>Jobs</span></a>
        <a href="#" class="tab-link" data-tab="applications"><span class="i">üìù</span><span>My Applications</span></a>
        <a href="#" class="tab-link" data-tab="saved"><span class="i">‚≠ê</span><span>Saved</span></a>
        <a href="#" class="tab-link" data-tab="manage"><span class="i">üß∞</span><span>Manage Posts</span></a>
        <a href="#" class="tab-link" data-tab="settings"><span class="i">‚öôÔ∏è</span><span>Account Settings</span></a>
      </nav>
      <div class="side-row">
        <span class="theme-label">Theme</span>
        <button id="themeToggle2" class="chip theme-toggle" aria-label="Toggle theme">üåô</button>
      </div>
    </aside>

    <!-- Main -->
    <div class="main">
      <div class="topbar glass">
        <h1 id="tab-title" class="wrap" style="margin:0;font-size:22px">Profile</h1>
        <div class="user-menu">
          <span id="username" class="wrap">Loading‚Ä¶</span>
          <img id="avatar" src="https://via.placeholder.com/80" alt="User Avatar">
        </div>
      </div>

      <div class="content">
        <!-- Profile -->
        <section id="profile" class="card glass" style="display:block">
          <h3>Profile</h3>
          <div style="display:flex;gap:14px;align-items:center;flex-wrap:wrap">
            <img id="profilePic" src="https://via.placeholder.com/100" alt="Profile Picture" style="width:90px;height:90px;border-radius:50%;object-fit:cover">
            <div class="wrap">
              <p id="profileName" style="margin:0 0 4px;font-weight:900">Your Name</p>
              <p id="profileEmail" class="meta" style="margin:0">Email: loading‚Ä¶</p>
            </div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
            <button class="btn btn-primary" id="btnUpdatePic">Update Picture</button>
            <button class="btn btn-primary" id="btnUploadCV" style="background:linear-gradient(90deg,#FFB44D,#FF8A00)">Upload CV</button>
          </div>
        </section>

        <!-- Jobs -->
        <section id="jobs" class="card glass" style="display:none">
          <h3>Find Jobs</h3>
          <div class="row glass" style="grid-template-columns:1fr auto">
            <div class="input"><input id="jobQuery" type="text" placeholder="Job title or keyword"></div>
            <div class="input"><input id="jobLocation" type="text" placeholder="Location"></div>
            <button class="btn btn-primary" id="btnSearch">Search</button>
          </div>
          <div class="card glass" style="margin-top:12px">
            <h3>Results</h3>
            <div class="list" id="jobsList"></div>
            <div style="text-align:center;margin-top:10px">
              <button class="btn btn-primary" id="btnMore" style="display:none;background:linear-gradient(90deg,#FFB44D,#FF8A00)">Load More</button>
            </div>
          </div>
        </section>

        <!-- Applications -->
        <section id="applications" class="card glass" style="display:none">
          <h3>My Applications</h3>
          <div class="list" id="appsList"></div>
          <p id="appsEmpty" class="meta" style="display:none">No applications yet.</p>
        </section>

        <!-- Saved -->
        <section id="saved" class="card glass" style="display:none">
          <h3>Saved Jobs</h3>
          <div class="list" id="savedList"></div>
          <p id="savedEmpty" class="meta" style="display:none">No saved jobs yet.</p>
        </section>

        <!-- Manage Posts -->
        <section id="manage" class="card glass" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <h3>Manage Posts</h3>
            <div style="display:flex;gap:8px">
              <label class="btn btn-line" style="cursor:pointer">
                Import CSV
                <input id="jobsCsvInput" type="file" accept=".csv" style="display:none">
              </label>
              <button class="btn btn-primary" id="btnNewPost">New Post</button>
            </div>
          </div>
          <div id="manageList" class="list" style="margin-top:10px"></div>
        </section>

        <!-- Settings -->
        <section id="settings" class="card glass" style="display:none">
          <h3>Account Settings</h3>
          <div class="input"><input id="nameInput" placeholder="Display Name" /></div>
          <p class="meta" style="margin-top:6px">Theme is synced across pages. Your brand color control will come next.</p>
        </section>
      </div>
    </div>
  </main>

  <footer style="max-width:1100px;margin:0 auto 24px;padding:0 16px;text-align:center;color:var(--muted)">
    ¬© 2025 CaribCareerHub
  </footer>

  <!-- Supabase + App -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    /* Theme (shared) */
    (function initTheme(){
      const saved = localStorage.getItem('cch.theme');
      if (saved === 'dark') document.body.classList.add('dark');
      if (!saved){
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) document.body.classList.add('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
      }
      const toggles = [document.getElementById('themeToggle'), document.getElementById('themeToggle2')].filter(Boolean);
      const setIcon = () => toggles.forEach(btn => btn.textContent = document.body.classList.contains('dark') ? 'üåû' : 'üåô');
      setIcon();
      toggles.forEach(btn => btn.addEventListener('click', ()=>{
        document.body.classList.toggle('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
        setIcon();
      }));
    })();

    /* Supabase init */
    const SUPABASE_URL = "https://fpytvfhynleaivkvuedt.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZweXR2Zmh5bmxlYWl2a3Z1ZWR0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzU1OTAsImV4cCI6MjA3MTI1MTU5MH0.Q7UHLIA_3_o7zCdV-IOthWOYGVVlINDXjp1uF4sdBRk";
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const LOGIN_PAGE = "login.html";
    let currentUser = null;

    (async () => {
      const { data:{ session } } = await supabaseClient.auth.getSession();
      if (!session) return (window.location.href = LOGIN_PAGE);
      currentUser = session.user;
      const name = currentUser.user_metadata?.full_name || currentUser.email;
      document.getElementById('username').textContent = name;
      document.getElementById('profileName').textContent = name;
      document.getElementById('profileEmail').textContent = "Email: " + (currentUser.email || "");
      document.getElementById('nameInput').value = currentUser.user_metadata?.full_name || "";
      loadJobs(true); loadApplications(); loadManaged();
    })();
    supabaseClient.auth.onAuthStateChange((ev)=>{ if (ev === "SIGNED_OUT") window.location.href = LOGIN_PAGE; });

    /* Logout */
    document.getElementById('logoutBtn').addEventListener('click', async ()=>{ await supabaseClient.auth.signOut(); });

    /* Tabs */
    const links = Array.from(document.querySelectorAll('.tab-link'));
    const title = document.getElementById('tab-title');
    function setTab(tab){
      links.forEach(l => l.classList.toggle('active', l.dataset.tab===tab));
      document.querySelectorAll('.card.glass').forEach(c => c.style.display = (c.id===tab ? 'block':'none'));
      const active = links.find(l => l.dataset.tab===tab);
      title.textContent = active ? active.textContent.replace(/^[^\w]+/, '') : 'Dashboard';
      localStorage.setItem('dashTab', tab);
    }
    links.forEach(a => a.addEventListener('click', (e)=>{ e.preventDefault(); setTab(a.dataset.tab); }));
    setTab(localStorage.getItem('dashTab') || 'profile');

    /* Jobs (search + paging + saved) */
    const jobsList = document.getElementById('jobsList');
    const btnMore = document.getElementById('btnMore');
    const btnSearch = document.getElementById('btnSearch');
    const jobQuery = document.getElementById('jobQuery');
    const jobLocation = document.getElementById('jobLocation');
    let savedJobs = JSON.parse(localStorage.getItem('savedJobs') || "[]");
    let page = 0, pageSize = 8;
    function isSaved(id){ return savedJobs.some(j=>j.id===id); }
    function toggleSave(job){
      const i = savedJobs.findIndex(j=>j.id===job.id); if (i>=0) savedJobs.splice(i,1); else savedJobs.push(job);
      localStorage.setItem('savedJobs', JSON.stringify(savedJobs));
      document.querySelectorAll(`.save-btn[data-id="${job.id}"]`).forEach(btn=>btn.classList.toggle('saved', isSaved(job.id)));
      renderSaved();
    }
    function makeJobRow(job){
      const id = String(job.id ?? job.uuid ?? job.slug ?? `${job.title}-${job.created_at}`);
      const el = document.createElement('div');
      el.className = "row glass";
      el.innerHTML = `<div class="wrap"><h4 class="wrap">${job.title || "Untitled role"}</h4><p class="meta wrap">${job.company || ""} ${job.location ? "‚Ä¢ " + job.location : ""} ${job.type ? "‚Ä¢ " + job.type : ""}</p></div><button class="save-btn ${isSaved(id) ? "saved":""}" data-id="${id}" aria-label="Save job">‚≠ê</button>`;
      el.querySelector('.save-btn').addEventListener('click', ()=>toggleSave({ id, title: job.title || "Untitled role", company: job.company || "", location: job.location || "" }));
      return el;
    }
    async function loadJobs(reset=false){
      if (reset){ page = 0; jobsList.innerHTML = `<div class="meta">Loading‚Ä¶</div>`; }
      const from = page * pageSize, to = from + pageSize - 1;
      const { data, error } = await supabaseClient.from('jobs').select('*').order('created_at', { ascending:false }).range(from, to);
      if (error){ jobsList.innerHTML = `<div class="meta">‚ùå Failed to load jobs.</div>`; btnMore.style.display="none"; return; }
      const q = (jobQuery.value || "").toLowerCase(), loc = (jobLocation.value || "").toLowerCase();
      const rows = (data||[]).filter(r => (!q || ((r.title||"")+(r.description||"")).toLowerCase().includes(q)) && (!loc || (r.location||"").toLowerCase().includes(loc)));
      if (reset) jobsList.innerHTML = "";
      if (reset && rows.length===0){ jobsList.innerHTML = `<div class="meta">No jobs yet.</div>`; btnMore.style.display="none"; return; }
      rows.forEach(job => jobsList.appendChild(makeJobRow(job)));
      btnMore.style.display = rows.length === pageSize ? "inline-block" : "none";
    }
    btnSearch.addEventListener('click', ()=>loadJobs(true));
    btnMore.addEventListener('click', ()=>{ page++; loadJobs(false); });
    supabaseClient.channel('jobs-updates').on('postgres_changes',{event:'*',schema:'public',table:'jobs'},()=>{ loadJobs(true); loadManaged(); }).subscribe();

    /* Saved render */
    const savedList = document.getElementById('savedList');
    const savedEmpty = document.getElementById('savedEmpty');
    function renderSaved(){
      savedList.innerHTML = "";
      if (!savedJobs.length){ savedEmpty.style.display = "block"; return; }
      savedEmpty.style.display = "none";
      savedJobs.forEach(job=>{
        const el = document.createElement('div'); el.className = "row glass";
        el.innerHTML = `<div class="wrap"><h4>${job.title}</h4><p class="meta">${job.company || ""} ${job.location ? "‚Ä¢ " + job.location : ""}</p></div><button class="save-btn saved" data-id="${job.id}" aria-label="Unsave job">‚≠ê</button>`;
        el.querySelector('.save-btn').addEventListener('click', ()=>toggleSave(job));
        savedList.appendChild(el);
      });
    }
    renderSaved();

    /* Applications */
    const appsList = document.getElementById('appsList');
    const appsEmpty = document.getElementById('appsEmpty');
    async function loadApplications(){
      appsList.innerHTML = `<div class="meta">Loading‚Ä¶</div>`;
      const { data, error } = await supabaseClient.from('applications').select('*').eq('user_id', currentUser.id).order('applied_at', { ascending:false });
      if (error){ appsList.innerHTML = `<div class="meta">‚ùå Failed to load applications.</div>`; return; }
      appsList.innerHTML = "";
      if (!data || data.length===0){ appsEmpty.style.display = "block"; return; }
      appsEmpty.style.display = "none";
      data.forEach(app=>{
        const status = (app.status || 'Applied').toLowerCase();
        const badgeClass = status.includes('interview') ? 'b-interview' : status.includes('offer') ? 'b-offer' : status.includes('reject') ? 'b-rejected' : 'b-applied';
        const row = document.createElement('div'); row.className = "row glass";
        row.innerHTML = `<div class="wrap"><h4 class="wrap">${app.job_title || 'Untitled role'}</h4><p class="meta wrap">${app.company || ''} ${app.location ? '‚Ä¢ ' + app.location : ''} ‚Ä¢ ${app.applied_at ? new Date(app.applied_at).toLocaleDateString() : ''}</p></div><span class="badge ${badgeClass}" title="${app.status || 'Applied'}">${(app.status || 'Applied')}</span>`;
        appsList.appendChild(row);
      });
    }

    /* Manage Posts (employer) */
    const manageList = document.getElementById('manageList');
    async function loadManaged(){
      manageList.innerHTML = `<div class="meta">Loading‚Ä¶</div>`;
      const { data, error } = await supabaseClient.from('jobs').select('*').eq('user_id', currentUser.id).order('created_at', { ascending:false });
      if (error){ manageList.innerHTML = `<div class="meta">‚ùå Failed to load posts.</div>`; return; }
      manageList.innerHTML = "";
      if (!data || data.length===0){ manageList.innerHTML = `<div class="meta">No posts yet. Use ‚ÄúNew Post‚Äù.</div>`; return; }
      data.forEach(job=>{
        const row = document.createElement('div'); row.className = "row glass";
        row.innerHTML = `<div class="wrap"><h4 class="wrap">${job.title}</h4><p class="meta wrap">${job.company || ""} ${job.location ? "‚Ä¢ " + job.location : ""} ‚Ä¢ ${new Date(job.created_at).toLocaleDateString()}</p></div>
                         <div style="display:flex;gap:8px">
                           <button class="btn btn-line" data-edit="${job.id}">Edit</button>
                           <button class="btn btn-primary" data-del="${job.id}" style="background:linear-gradient(90deg,#ff5a5a,#ff7a7a)">Delete</button>
                         </div>`;
        row.querySelector('[data-del]').addEventListener('click', async ()=>{
          if (!confirm('Delete this post?')) return;
          const { error } = await supabaseClient.from('jobs').delete().eq('id', job.id);
          if (error) return alert('Delete failed: ' + error.message);
          loadManaged();
        });
        manageList.appendChild(row);
      });
    }

    /* CSV Import */
    document.getElementById("jobsCsvInput").addEventListener("change", async (e) => {
      const file = e.target.files?.[0]; if (!file) return;
      const text = await file.text();
      const [header, ...lines] = text.split(/\r?\n/).filter(Boolean);
      const cols = header.split(",").map(h => h.trim().toLowerCase());
      const need = ["title","company","location","type","description"];
      for (const n of need) if (!cols.includes(n)) { alert("CSV must have: " + need.join(", ")); return; }
      const rows = lines.map(line => {
        const vals = line.split(","); const obj = {};
        cols.forEach((c,i)=> obj[c] = (vals[i]||"").trim());
        return { user_id: currentUser.id, title: obj.title, company: obj.company, location: obj.location, type: obj.type || "Full-time", description: obj.description };
      });
      const { error } = await supabaseClient.from("jobs").insert(rows);
      if (error) { alert("Import failed: " + error.message); return; }
      alert("Imported " + rows.length + " jobs");
      loadJobs(true); loadManaged();
    });

    /* New Post Modal */
    const backdrop = document.createElement('div');
    backdrop.className = 'backdrop';
    backdrop.innerHTML = `
      <div class="modal glass">
        <div class="head">
          <h2 class="title">Post a Job</h2>
          <button class="close">√ó</button>
        </div>
        <form id="postForm" class="grid" novalidate>
          <div class="grid two">
            <div class="input"><input id="pf_title" required placeholder="Title (e.g., Frontend Developer)"></div>
            <div class="input"><input id="pf_company" placeholder="Company (e.g., CaribCareerHub)"></div>
          </div>
          <div class="grid two">
            <div class="input"><input id="pf_location" placeholder="Location (e.g., Kingston, Jamaica)"></div>
            <div class="input">
              <select id="pf_type">
                <option>Full-time</option><option>Part-time</option><option>Remote</option><option>On-site</option>
              </select>
            </div>
          </div>
          <div class="input"><textarea id="pf_desc" placeholder="Short role summary..."></textarea></div>
          <div class="actions">
            <span id="postMsg" class="note"></span>
            <button type="button" class="btn btn-line" id="postCancel">Cancel</button>
            <button type="submit" class="btn btn-primary" id="postSubmit">Publish</button>
          </div>
        </form>
      </div>`;
    document.body.appendChild(backdrop);

    function openPost(){ backdrop.classList.add('open'); document.getElementById('pf_title').focus(); }
    function closePost(){ backdrop.classList.remove('open'); const f=document.getElementById('postForm'); f.reset(); document.getElementById('postMsg').textContent=""; }
    document.getElementById('btnNewPost').addEventListener('click', openPost);
    backdrop.addEventListener('click', (e)=>{ if (e.target === backdrop || e.target.classList.contains('close')) closePost(); });
    document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && backdrop.classList.contains('open')) closePost(); });
    document.getElementById('postCancel').addEventListener('click', closePost);

    document.getElementById('postForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const title = document.getElementById('pf_title').value.trim();
      const company = document.getElementById('pf_company').value.trim();
      const location = document.getElementById('pf_location').value.trim();
      const type = document.getElementById('pf_type').value;
      const description = document.getElementById('pf_desc').value.trim();
      const msg = document.getElementById('postMsg');
      const btn = document.getElementById('postSubmit');

      if (!title){ msg.textContent="Title is required."; msg.className="note err"; return; }
      btn.disabled = true; msg.textContent="Publishing‚Ä¶"; msg.className="note";
      const { error } = await supabaseClient.from('jobs').insert([{ user_id: currentUser.id, title, company, location, type, description }]);
      btn.disabled = false;
      if (error){ msg.textContent="‚ùå " + error.message; msg.className="note err"; return; }
      msg.textContent="‚úÖ Posted!"; msg.className="note ok";
      loadJobs(true); loadManaged();
      setTimeout(closePost, 600);
    });

    /* Name inline update */
    document.getElementById('nameInput').addEventListener('change', async (e)=>{
      const full_name = (e.target.value || "").trim(); if (!full_name || !currentUser) return;
      const { error } = await supabaseClient.auth.updateUser({ data:{ full_name } });
      if (!error){ document.getElementById('username').textContent = full_name; document.getElementById('profileName').textContent = full_name; }
    });

    /* Dummy upload buttons */
    document.getElementById('btnUpdatePic').addEventListener('click', ()=>alert('Profile photo upload not yet wired.'));
    document.getElementById('btnUploadCV').addEventListener('click', ()=>alert('CV upload not yet wired.'));
  </script>
</body>
</html>


<!-- ============================
File: employer.html
Simple employer landing + theme toggle + CTA to Dashboard/Manage Posts.
(Use when you want a separate page for employers; optional.)
============================ -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Employers ‚Ä¢ CaribCareerHub</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#F3F8FF; --panel:#ffffff; --ink:#0A2458; --muted:#6B7A99;
      --brand:#1E6CFF; --brand-2:#3FA2FF; --accent:#FFA03B;
      --radius:18px; --shadow:0 10px 30px rgba(16,40,120,.12); --ring:0 0 0 3px rgba(30,108,255,.14);
      --line: color-mix(in oklab, var(--ink) 12%, transparent);
    }
    body.dark{
      --bg:#0b1220; --panel:#121a2b; --ink:#eaf0ff; --muted:#a7b3cc;
      --brand:#5a8fff; --brand-2:#8ec4ff; --accent:#ffb86c;
      --shadow:0 16px 44px rgba(0,0,0,.5); --ring:0 0 0 3px rgba(142,196,255,.22);
      --line: color-mix(in oklab, var(--ink) 18%, transparent);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .header{max-width:1100px;margin:16px auto 0;padding:0 16px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .brand .logo{width:80px;height:80px;object-fit:contain}
    .brand-name{font-weight:900;letter-spacing:4px}
    .chip{border:1px solid var(--line);background:var(--panel);color:var(--ink);border-radius:12px;padding:8px 10px;font-weight:900;cursor:pointer}
    .panel{max-width:1000px;margin:18px auto 40px;padding:24px;border-radius:18px;border:1px solid var(--line);background: color-mix(in oklab, var(--panel) 92%, transparent);box-shadow:var(--shadow)}
    .hero{ text-align:center }
    .hero h1{margin:8px 0 8px;font-size:clamp(28px,6vw,44px);letter-spacing:.4px}
    .lede{max-width:720px;margin:0 auto 12px;color:var(--muted)}
    .cta{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:14px}
    .btn{border:none;border-radius:12px;padding:12px 16px;font-weight:900;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#fff}
    .btn-line{background:transparent;border:1px solid var(--line);color:var(--ink)}
    .grid{display:grid;gap:14px;margin-top:18px}
    .card{border:1px solid var(--line);border-radius:14px;padding:16px;background:var(--panel);box-shadow:var(--shadow)}
    .card h3{margin:0 0 6px}
    .meta{color:var(--muted)}
    .footer{max-width:1100px;margin:10px auto 40px;padding:0 16px;display:flex;justify-content:center;gap:22px;flex-wrap:wrap}
    .footer a{color:var(--ink);text-decoration:none;font-weight:900;border-bottom:2px solid transparent;padding-bottom:2px}
    .footer a:hover{border-color: color-mix(in oklab, var(--brand) 50%, transparent)}
  </style>
</head>
<body>
  <header class="header">
    <div class="brand">
      <img src="./assets/logo.svg" class="logo" alt="CaribCareerHub logo" />
      <div class="brand-name">CARRIBCAREERHUB</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <button id="themeToggle" class="chip">üåô</button>
      <a href="login.html" class="btn btn-primary">Login</a>
    </div>
  </header>

  <main class="panel">
    <section class="hero">
      <h1>Hire the Right Talent ‚Äî Fast.</h1>
      <p class="lede">
        Post your roles to reach skilled candidates across Jamaica, Barbados, Trinidad and more.
        Our streamlined dashboard helps you publish in minutes and manage applications with ease.
      </p>
      <div class="cta">
        <a class="btn btn-primary" href="dashboard.html">Go to Employer Dashboard</a>
        <a class="btn btn-line" href="register.html">Create an Account</a>
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <h3>Smart Distribution</h3>
        <p class="meta">Your jobs are showcased to relevant seekers first for better matches.</p>
      </div>
      <div class="card">
        <h3>Application Tracking</h3>
        <p class="meta">Review candidates, mark stages, and move quickly ‚Äî all in one place.</p>
      </div>
      <div class="card">
        <h3>Local Reach</h3>
        <p class="meta">Tap into Caribbean talent pools with roles across islands and remote.</p>
      </div>
    </section>
  </main>

  <footer class="footer">
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
    <a href="privacy.html">Privacy</a>
    <a href="terms.html">Terms</a>
  </footer>

  <script>
    (function initTheme(){
      const saved = localStorage.getItem('cch.theme');
      if (saved === 'dark') document.body.classList.add('dark');
      if (!saved){
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) document.body.classList.add('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
      }
      const btn = document.getElementById('themeToggle');
      const setIcon = () => btn.textContent = document.body.classList.contains('dark') ? 'üåû' : 'üåô';
      setIcon();
      btn.addEventListener('click', ()=>{
        document.body.classList.toggle('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
        setIcon();
      });
    })();
  </script>
</body>
</html>
