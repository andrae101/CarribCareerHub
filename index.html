<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CaribCareerHub â€¢ Caribbean Jobs</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="canonical" href="https://carribcareerhub.site/" />
  <style>
    :root{
      --bg:#0f1525; --panel:#111a2e; --ink:#ecf2ff; --muted:#b7c1d6;
      --brand:#5a8fff; --brand-2:#8ec4ff; --accent:#ffb86c;
      --radius:18px; --shadow:0 14px 40px rgba(0,0,0,.45);
      --border:1px solid rgba(255,255,255,.12);
      --ring:0 0 0 3px rgba(138,180,248,.25);
    }
    body.light{
      --bg:#F3F8FF; --panel:#ffffff; --ink:#0A2458; --muted:#6B7A99;
      --brand:#1E6CFF; --brand-2:#3FA2FF; --accent:#FFA03B;
      --shadow:0 10px 30px rgba(16,40,120,0.12);
      --border:1px solid rgba(10,36,88,.12);
      --ring:0 0 0 3px rgba(30,108,255,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; overflow-x:hidden; font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; color:var(--ink); background:var(--bg) }

    /* Top banner â€” fills safe area left/right */
    .highlight-banner{
      position:sticky; top:0; z-index:1000;
      background:linear-gradient(90deg,var(--brand),var(--brand-2));
      color:#fff; text-align:center; font-weight:800;
      padding:10px max(12px, env(safe-area-inset-right)) 10px max(12px, env(safe-area-inset-left));
      font-size:14px; letter-spacing:.3px; box-shadow:var(--shadow);
      width:100%;
    }

    /* Header */
    .header{ max-width:1100px; margin:12px auto 0; padding:0 16px; display:flex; align-items:center; justify-content:space-between; gap:12px }
    .brand{display:flex; align-items:center; gap:10px; min-width:0}
    .logo{width:54px; height:54px; object-fit:contain}
    .brand-name{font-size:20px; font-weight:900; letter-spacing:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    .controls{display:flex; gap:8px; align-items:center; flex-shrink:0}
    .btn{ border:none; padding:8px 12px; border-radius:12px; font-weight:800; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; white-space:nowrap }
    .btn-primary{ color:#fff; background:linear-gradient(90deg,var(--brand),var(--brand-2)); box-shadow:var(--shadow); text-decoration:none; max-height:38px }
    .btn-ghost{ background:var(--panel); color:var(--ink); border:var(--border) }
    /* dark-mode contrast for the theme toggle */
    body:not(.light) .btn-ghost{ background:#23325b; color:#fff; border:1px solid rgba(255,255,255,.25) }

    .btn:focus-visible{ outline:none; box-shadow:var(--ring) }

    /* Panel */
    .panel{
      max-width:1100px; margin:16px auto 32px; padding:20px;
      background:color-mix(in oklab, var(--panel) 90%, transparent);
      border:var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    }
    .panel-content{ display:grid; grid-template-columns:1.1fr .9fr; gap:24px }

    /* Hero */
    .hero-title{ font-size: clamp(28px, 6vw, 46px); font-weight:900; line-height:1.2; margin:6px 0 6px; text-align:center; letter-spacing:.3px }
    .tagline{ margin:0 auto 12px; text-align:center; color:var(--muted); font-weight:700; max-width:720px }
    .employer-callout{
      margin:12px auto 0; padding:12px 14px; border-radius:14px;
      background:linear-gradient(0deg, color-mix(in oklab, var(--accent) 15%, var(--panel)), var(--panel));
      border:var(--border); color:var(--ink); text-align:center; max-width:720px; font-weight:800;
    }
    .employer-callout strong{ color:inherit }
    .employer-callout a{ color:var(--brand); text-decoration:none; border-bottom:2px solid transparent }
    .employer-callout a:hover{ border-color: color-mix(in oklab, var(--brand) 50%, transparent) }

    /* Jobs list */
    .jobs{ margin-top:18px }
    .jobs h2{ margin:12px 0 10px }
    .job-card{
      display:grid; gap:6px; border:var(--border); border-radius:12px;
      padding:12px 14px; background:var(--panel); box-shadow:var(--shadow); margin-bottom:12px;
    }
    .job-title{ margin:0; font-size:18px; font-weight:900; line-height:1.25 }
    .job-company{ margin:0; color:var(--muted); font-weight:700 }
    .job-meta{ margin:0; color:var(--brand); font-weight:800 }
    .wrap{ word-break:break-word; overflow-wrap:anywhere }
    .load-more{ display:inline-block; margin:12px auto 0; padding:10px 14px; font-weight:900; border:none; border-radius:12px;
      background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#fff; cursor:pointer; box-shadow:var(--shadow) }

    /* Map */
    .map-wrap{ display:flex; align-items:center; justify-content:center }
    .map-wrap img{ width:100%; max-width:520px; height:auto; object-fit:contain; opacity:.9 }

    /* Footer (balanced spacing) */
    .footer{ max-width:1100px; margin:10px auto 40px; padding:0 16px; display:flex; flex-direction:column; gap:10px }
    .links{ display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:18px }
    @media (min-width: 780px){ .links{ justify-content:space-between } }
    .footer a{ color:var(--ink); text-decoration:none; font-weight:900; border-bottom:2px solid transparent; padding-bottom:2px }
    .footer a:hover{ border-color: color-mix(in oklab, var(--brand) 50%, transparent) }
    .copy{ color:var(--muted); font-weight:700; text-align:center }

    @media (max-width: 900px){
      .panel-content{ grid-template-columns: 1fr }
      .brand-name{ font-size:18px; letter-spacing:2px }
      .logo{ width:48px; height:48px }
    }
  </style>
</head>
<body>
  <!-- Banner -->
  <div class="highlight-banner">ðŸŒ´ CaribCareerHub â€” Real jobs across Jamaica ðŸ‡¯ðŸ‡² â€¢ Barbados ðŸ‡§ðŸ‡§ â€¢ Trinidad ðŸ‡¹ðŸ‡¹</div>

  <!-- Header -->
  <header class="header">
    <div class="brand">
      <picture>
        <source srcset="./assets/logo.svg" type="image/svg+xml" />
        <img src="./assets/logo.png" alt="CaribCareerHub logo" class="logo" />
      </picture>
      <span class="brand-name">CARRIBCAREERHUB</span>
    </div>
    <div class="controls">
      <button id="themeToggle" class="btn btn-ghost" aria-label="Toggle theme">ðŸŒ™</button>
      <a class="btn btn-primary" href="login.html">Login</a>
    </div>
  </header>

  <!-- Main -->
  <main class="panel">
    <div class="panel-content">
      <section>
        <h1 class="hero-title">Find Your Next Role in the Caribbean</h1>
        <p class="tagline">Real companies. Real opportunities. Your next chapter starts here.</p>

        <p class="employer-callout">
          ðŸ“£ <strong>Employers:</strong> Reach Caribbean talent fast â€”
          <a href="employers.html">post your job from your dashboard</a>.
        </p>

        <!-- Latest Jobs (no search UI) -->
        <div class="jobs">
          <h2>Latest Jobs</h2>
          <div id="jobsContainer" class="wrap">Loading jobsâ€¦</div>
          <button id="loadMoreBtn" class="load-more" style="display:none">Load More</button>
        </div>
      </section>

      <aside class="map-wrap">
        <picture>
          <source srcset="./assets/map.svg" type="image/svg+xml">
          <img src="./assets/map.png" alt="Caribbean map" />
        </picture>
      </aside>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <nav class="links">
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </nav>
    <div class="copy">Â© 2025 CaribCareerHub</div>
  </footer>

  <!-- Theme + Latest Jobs loader (unchanged logic) -->
  <script>
    // theme
    (function(){
      const saved = localStorage.getItem('cch.theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = saved ? saved === 'dark' : prefersDark;
      document.body.classList.toggle('light', !isDark);
      const btn = document.getElementById('themeToggle');
      const sync = () => btn.textContent = document.body.classList.contains('light') ? 'ðŸŒ™' : 'ðŸŒž';
      sync();
      btn.addEventListener('click', ()=>{
        document.body.classList.toggle('light');
        localStorage.setItem('cch.theme', document.body.classList.contains('light') ? 'light' : 'dark');
        sync();
      });
    })();

    // jobs (Adzuna via /api/adzuna + Remotive public)
    const PAGE_SIZE = 10;
    const DEFAULT_QUERY = "";
    const DEFAULT_LOCATION = "Jamaica";

    const list = document.getElementById('jobsContainer');
    const moreBtn = document.getElementById('loadMoreBtn');
    const state = { page: 1 };

    const esc = s => (s??"").toString().replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m]));
    const stripHtml = html => { const d = document.createElement('div'); d.innerHTML = html||""; return d.textContent||d.innerText||""; };

    function normalize(j, source){
      return {
        id: j.id || j.job_id || j.url || crypto.randomUUID(),
        title: j.title || j.job_title || "Untitled role",
        company: j.company?.display_name || j.company || j.company_name || j.employer_name || "",
        location: j.location?.display_name || j.job_city || j.candidate_required_location || j.job_country || "",
        type: j.contract_type || j.contract_time || j.job_employment_type || "",
        description: j.description ? stripHtml(j.description) : (j.job_description||""),
        apply_url: j.redirect_url || j.url || j.job_apply_link || "#",
        posted_at: j.created || j.publication_date || j.job_posted_at_datetime_utc || null,
        source
      };
    }

    async function fetchAdzuna(page){
      const url = `/api/adzuna?what=${encodeURIComponent(DEFAULT_QUERY)}&where=${encodeURIComponent(DEFAULT_LOCATION)}&page=${page}&per_page=${PAGE_SIZE}`;
      const r = await fetch(url);
      if (!r.ok) return [];
      const json = await r.json();
      return (json.results||[]).map(x => normalize(x, "Adzuna"));
    }

    async function fetchRemotive(page){
      const r = await fetch(`https://remotive.com/api/remote-jobs?search=${encodeURIComponent(DEFAULT_QUERY)}`);
      if (!r.ok) return [];
      const json = await r.json();
      return (json.jobs||[])
        .filter(j => (j.candidate_required_location||"").toLowerCase().includes(DEFAULT_LOCATION.toLowerCase()))
        .slice((page-1)*PAGE_SIZE, page*PAGE_SIZE)
        .map(x => normalize({
          id:x.id, title:x.title, company_name:x.company_name,
          candidate_required_location:x.candidate_required_location, job_type:x.job_type,
          description: stripHtml(x.description||""), url:x.url, publication_date:x.publication_date
        }, "Remotive"));
    }

    function renderCard(j){
      const el = document.createElement('div');
      el.className = 'job-card wrap';
      el.innerHTML = `
        <div class="job-title">${esc(j.title)}</div>
        <div class="job-company">${esc(j.company)}</div>
        <div class="job-meta">${esc([j.location, j.type].filter(Boolean).join(' â€¢ '))}</div>
        <p class="wrap" style="margin:8px 0 10px">${esc((j.description||"").slice(0,220))}${j.description && j.description.length>220 ? "â€¦" : ""}</p>
        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap">
          <a href="${j.apply_url}" target="_blank" rel="noopener" class="btn btn-primary" style="padding:8px 12px">Apply</a>
          <span style="font-size:12px;color:var(--muted);font-weight:800">Source: ${esc(j.source)}</span>
        </div>`;
      list.appendChild(el);
    }

    async function loadPage(reset=false){
      try{
        if (reset){ state.page = 1; list.textContent = "Loading jobsâ€¦"; }
        const [a, r] = await Promise.all([fetchAdzuna(state.page), fetchRemotive(state.page)]);
        const merged = [...a, ...r];

        // dedupe + sort
        const seen = new Set(); const dedup = [];
        for (const j of merged){
          const key = [j.title, j.company, j.location].map(s => (s||"").toLowerCase().trim()).join("|");
          if (seen.has(key)) continue; seen.add(key); dedup.push(j);
        }
        dedup.sort((x,y)=> (Date.parse(y.posted_at||0)||0) - (Date.parse(x.posted_at||0)||0));

        if (reset) list.innerHTML = "";
        if (!dedup.length && reset){ list.textContent = "No jobs yet."; moreBtn.style.display='none'; return; }

        dedup.forEach(renderCard);
        moreBtn.style.display = dedup.length >= PAGE_SIZE ? 'block' : 'none';
      }catch(e){
        console.error(e);
        if (state.page===1) list.textContent = "Failed to load jobs.";
        moreBtn.style.display='none';
      }
    }

    document.getElementById('loadMoreBtn').addEventListener('click', ()=>{
      state.page += 1; loadPage(false);
    });

    loadPage(true);
  </script>
</body>
</html>
