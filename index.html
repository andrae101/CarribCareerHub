<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CaribCareerHub â€¢ Find Jobs Across the Caribbean</title>
  <link rel="canonical" href="https://carribcareerhub.site/" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#F3F8FF;
      --panel:#ffffff;
      --ink:#0A2458;
      --muted:#6B7A99;
      --brand:#1E6CFF;
      --brand-2:#3FA2FF;
      --accent:#FFA03B;
      --radius:18px;
      --shadow:0 10px 30px rgba(16,40,120,0.12);
      --ring:0 0 0 3px rgba(30,108,255,.14);
    }
    /* ðŸŒ‘ smoother dark palette (navy w/ soft panels) */
    body.dark{
      --bg:#0b1220;            /* deeper navy */
      --panel:#121a2b;         /* soft panel */
      --ink:#eaf0ff;           /* ink on dark */
      --muted:#a7b3cc;         /* muted on dark */
      --brand:#5a8fff;         /* keep brand vivid */
      --brand-2:#8ec4ff;
      --accent:#ffb86c;
      --shadow:0 16px 44px rgba(0,0,0,.5);
      --ring:0 0 0 3px rgba(142,196,255,.22);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--ink);
      background: var(--bg);
      overflow-x:hidden;
    }

    /* Top banner â€” full bleed with safe-area */
    .highlight-banner{
      position:sticky; top:0; left:0; right:0; z-index:1000; width:100%;
      background:linear-gradient(90deg,var(--brand),var(--brand-2));
      color:#fff; text-align:center; font-weight:800; letter-spacing:.3px;
      padding:10px calc(16px + env(safe-area-inset-right)) 10px calc(16px + env(safe-area-inset-left));
      font-size:14px; box-shadow:var(--shadow);
    }

    /* Header */
    .header{
      max-width:1100px; margin:14px auto 0; padding:0 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:12px; min-width:0}
    .brand .logo{width:86px;height:86px;object-fit:contain; flex:0 0 auto}
    .brand-name{font-size:24px;font-weight:900;letter-spacing:4px;white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .right-rail{display:flex; align-items:center; gap:10px; flex:0 0 auto}

    .login-btn{
      display:inline-block; padding:8px 12px; border-radius:12px;
      font-weight:800; text-decoration:none; color:#fff; font-size:14px;
      background:linear-gradient(90deg,var(--brand),var(--brand-2)); box-shadow:var(--shadow);
      white-space:nowrap;
    }
    .theme-toggle{
      border:1px solid rgba(0,0,0,.08); padding:8px 10px; border-radius:12px;
      background:var(--panel); color:var(--ink); cursor:pointer; font-weight:900;
      line-height:1; box-shadow:var(--shadow);
    }
    body.dark .theme-toggle{
      background:#0e1630; color:#ffd86b; border-color:rgba(255,255,255,.18);
      text-shadow:0 0 0 transparent; /* keeps emoji crisp */
    }

    /* Panel (hero + map) */
    .panel{
      max-width:1100px; margin:16px auto 32px; padding:24px; border-radius:var(--radius);
      background:color-mix(in oklab, var(--panel) 90%, transparent); box-shadow:var(--shadow);
      border:1px solid color-mix(in oklab, var(--ink) 10%, transparent);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    }
    .panel-content{ display:grid; grid-template-columns:1.1fr .9fr; gap:24px; }

    /* Hero */
    .hero-title{
      font-size: clamp(32px, 6vw, 54px);
      font-weight:900; line-height:1.25; margin:10px 0 8px; text-align:center;
      letter-spacing:.4px;
    }
    .lede{
      font-size:17px; line-height:1.75; color:var(--muted);
      margin:0 auto 14px; text-align:center; max-width:720px;
    }
    .employer-callout{
      margin:16px auto 10px; padding:14px; border-radius:12px; max-width:720px; text-align:center;
      background:#fff6e9; border:1px solid #ffd9a8; color:#8a560a; font-weight:800;
    }
    body.dark .employer-callout{ background:#2a1e0e; border-color:#5a3d13; color:#ffd9a8 }

    /* Jobs */
    .jobs-list{ margin-top:18px }
    .job-card{
      display:grid; gap:6px; border:1px solid color-mix(in oklab, var(--ink) 10%, transparent);
      border-radius:12px; padding:12px 14px; background:var(--panel); box-shadow:var(--shadow); margin-bottom:12px;
    }
    .job-title{ margin:0; font-size:18px; font-weight:900; line-height:1.25 }
    .job-company{ margin:0; color:var(--muted); font-weight:700 }
    .job-location{ margin:0; color:var(--brand); font-weight:800 }
    .wrap{ word-break: break-word; overflow-wrap: anywhere }
    .load-more{
      display:inline-block; margin:12px auto 0; padding:10px 14px; font-weight:900; border:none; border-radius:12px;
      background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#fff; cursor:pointer; box-shadow:var(--shadow)
    }

    /* Map */
    .map-wrap{ display:flex; align-items:center; justify-content:center }
    .map-wrap img{ width:100%; max-width:520px; height:auto; object-fit:contain; opacity:.9; }

    /* Footer */
    .footer{
      max-width:1100px; margin:10px auto 40px; padding:0 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .footer .links{ display:flex; gap:22px; flex-wrap:wrap; justify-content:center; margin:0 auto }
    .footer a{ color:var(--ink); text-decoration:none; font-weight:900; border-bottom:2px solid transparent; padding-bottom:2px }
    .footer a:hover{ border-color: color-mix(in oklab, var(--brand) 50%, transparent) }
    .copy{ color:var(--muted); font-weight:700 }

    /* Responsive */
    @media (max-width: 900px){
      .panel-content{ grid-template-columns: 1fr }
      .brand .logo{ width:72px; height:72px }
    }
    @media (max-width: 360px){
      .brand-name{ font-size:18px; letter-spacing:2px }
    }
  </style>
</head>
<body>

  <!-- Banner -->
  <div class="highlight-banner">
    ðŸŒ´ CaribCareerHub â€” Real jobs across Jamaica ðŸ‡¯ðŸ‡² â€¢ Barbados ðŸ‡§ðŸ‡§ â€¢ Trinidad ðŸ‡¹ðŸ‡¹
  </div>

  <!-- Header -->
  <header class="header">
    <div class="brand">
      <picture>
        <source srcset="./assets/logo.svg" type="image/svg+xml" />
        <img src="./assets/logo.png" alt="CaribCareerHub logo" class="logo" />
      </picture>
      <span class="brand-name">CARRIBCAREERHUB</span>
    </div>
    <div class="right-rail">
      <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
      <a href="login.html" class="login-btn">Login</a>
    </div>
  </header>

  <!-- Main -->
  <main class="panel">
    <div class="panel-content">
      <section>
        <h1 class="hero-title">Find Your Dream Job in the Caribbean</h1>
        <p class="lede">
          Job hunting is tough. We do the heavy lifting â€” tracking fresh roles across the islands and surfacing the best
          matches â€” so you can focus on landing the offer.
        </p>
        <p class="employer-callout">
          Employers: Post your openings and weâ€™ll get them in front of motivated Caribbean talent â€” fast.
          Publish from your dashboard and start meeting qualified candidates today.
        </p>

        <!-- Jobs -->
        <div class="jobs-list" id="jobsList">
          <h2 style="margin:14px 0 8px">Latest Jobs</h2>

          <div id="feedStatus" style="display:flex;align-items:center;gap:10px;margin:2px 0 12px;font-size:13px;color:var(--muted);font-weight:800">
            <span id="lastUpdated">Updated just now</span>
            <button id="refreshNow" style="border:none;padding:6px 10px;border-radius:10px;background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#fff;font-weight:900;cursor:pointer">
              Refresh
            </button>
          </div>

          <div id="jobsContainer" class="wrap">Loading jobsâ€¦</div>
          <button id="loadMoreBtn" class="load-more" style="display:none">Load More</button>
        </div>
      </section>

      <aside class="map-wrap">
        <picture>
          <source srcset="./assets/map.svg" type="image/svg+xml">
          <img src="./assets/map.png" alt="Caribbean map" />
        </picture>
      </aside>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="links">
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </div>
    <div class="copy">Â© 2025 CaribCareerHub</div>
  </footer>

  <script>
    /* Theme */
    (function initTheme(){
      const saved = localStorage.getItem('cch.theme');
      if (saved === 'dark') document.body.classList.add('dark');
      if (!saved){
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) document.body.classList.add('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
      }
      const btn = document.getElementById('themeToggle');
      const setIcon = () => btn.textContent = document.body.classList.contains('dark') ? 'ðŸŒž' : 'ðŸŒ™';
      setIcon();
      btn.addEventListener('click', ()=>{
        document.body.classList.toggle('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
        setIcon();
      });
    })();

    /* Config */
    const PAGE_SIZE = 10;
    const DEFAULT_QUERY = "";
    const DEFAULT_LOCATION = "Jamaica";

    /* DOM */
    const list = document.getElementById('jobsContainer');
    const moreBtn = document.getElementById('loadMoreBtn');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const refreshBtn = document.getElementById('refreshNow');

    /* State */
    const state = { q: DEFAULT_QUERY, loc: DEFAULT_LOCATION, page: 1 };

    /* Utils */
    const esc = (s)=> (s??"").toString().replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m]));
    const stripHtml = (html)=>{ const d = document.createElement('div'); d.innerHTML = html; return d.textContent || d.innerText || ""; };
    const keyFor = (j)=> [j.title,j.company,j.location].map(s=>(s||"").toLowerCase().trim()).join("|||");

    /* Normalizer */
    function normalizeJob(j, meta){
      return {
        id: j.id || j.uuid || j.job_id || j.job_uuid || j.url || j.apply_url || crypto.randomUUID(),
        title: j.title || j.job_title || "Untitled role",
        company: j.company || j.employer_name || j.company_name || "",
        location: j.location || j.job_city || j.job_country || j.candidate_required_location || "",
        type: j.type || j.job_employment_type || j.contract_type || j.contract_time || "",
        description: j.description || j.job_description || "",
        apply_url: j.url || j.job_apply_link || j.redirect_url || j.job_posting_url || "#",
        posted_at: j.created_at || j.created || j.posted_at || j.publication_date || null,
        source: meta.source
      };
    }

    /* Fetchers */
    async function fetchRemotive({ q, loc, page }){
      try{
        const res = await fetch(`https://remotive.com/api/remote-jobs?search=${encodeURIComponent(q)}`);
        if (!res.ok) return [];
        const json = await res.json();
        return (json.jobs||[])
          .filter(j => !loc || (j.candidate_required_location||"").toLowerCase().includes(loc.toLowerCase()) || loc.toLowerCase()==="remote")
          .slice((page-1)*PAGE_SIZE, page*PAGE_SIZE)
          .map(r => normalizeJob({
            id: r.id, title: r.title, company_name: r.company_name,
            candidate_required_location: r.candidate_required_location, job_type: r.job_type,
            description: stripHtml(r.description||""), url: r.url, publication_date: r.publication_date
          }, { source: "Remotive" }));
      }catch{ return []; }
    }

    async function fetchAdzuna({ q, loc, page }){
      try{
        const url = `/api/adzuna?what=${encodeURIComponent(q)}&where=${encodeURIComponent(loc)}&page=${page}&per_page=${PAGE_SIZE}`;
        const res = await fetch(url);
        if (!res.ok) return [];
        const json = await res.json();
        return (json.results||[]).map(r => normalizeJob({
          id: r.id, title: r.title, company: r.company?.display_name,
          location: r.location?.display_name, contract_type: r.contract_type || r.contract_time,
          description: stripHtml(r.description||""), redirect_url: r.redirect_url, created: r.created
        }, { source: "Adzuna" }));
      }catch{ return []; }
    }

    async function loadExternalPage({ q, loc, page }){
      const [adz, rem] = await Promise.all([
        fetchAdzuna({ q, loc, page }),
        fetchRemotive({ q, loc, page })
      ]);
      const merged = [...adz, ...rem];

      const seen = new Set(); const deduped = [];
      for (const j of merged){ const k = keyFor(j); if (seen.has(k)) continue; seen.add(k); deduped.push(j); }

      deduped.sort((a,b)=> (Date.parse(b.posted_at||0)||0) - (Date.parse(a.posted_at||0)||0));
      return deduped;
    }

    /* Render */
    function renderCard(j){
      const card = document.createElement('div');
      card.className = "job-card wrap";
      card.innerHTML = `
        <div class="job-title">${esc(j.title)}</div>
        <div class="job-company">${esc(j.company)}</div>
        <div class="job-location">${esc([j.location, j.type].filter(Boolean).join(" â€¢ "))}</div>
        <p class="wrap" style="margin:8px 0 10px">${esc((j.description||"").slice(0,220))}${j.description && j.description.length>220 ? "â€¦" : ""}</p>
        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap">
          <a href="${j.apply_url}" target="_blank" rel="noopener" class="login-btn" style="padding:8px 12px">Apply</a>
          <span class="wrap" style="font-size:12px;color:var(--muted);font-weight:800">Source: ${esc(j.source)}</span>
        </div>
      `;
      list.appendChild(card);
    }

    async function runSearch(reset=true){
      try{
        if (reset){ state.page = 1; list.textContent = "Loading jobsâ€¦"; }
        const results = await loadExternalPage({ q: state.q, loc: state.loc, page: state.page });
        if (reset) list.innerHTML = "";
        if (!results.length && reset){ list.textContent = "No jobs found yet."; moreBtn.style.display="none"; return; }
        results.slice(0, PAGE_SIZE).forEach(renderCard);
        moreBtn.style.display = results.length >= PAGE_SIZE ? "block" : "none";
      }catch{
        list.textContent = "Failed to load external jobs."; moreBtn.style.display="none";
      }
    }

    /* Load more */
    moreBtn.addEventListener('click', ()=>{ state.page += 1; runSearch(false); });

    /* Autoâ€‘refresh: 10â€“15 min with jitter + manual refresh button */
    (function enableAutoRefresh(){
      const MIN_MS = 10 * 60 * 1000;   // 10 minutes
      const MAX_MS = 15 * 60 * 1000;   // 15 minutes
      const jitter = () => MIN_MS + Math.random() * (MAX_MS - MIN_MS);
      const fmtTime = d => `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
      const setLastUpdated = (d=new Date()) => { if (lastUpdatedEl) lastUpdatedEl.textContent = `Updated ${fmtTime(d)}`; };

      let running = false, timer = null;
      async function refreshNow(){
        if (running) return;
        running = true;
        try{ await runSearch(true); setLastUpdated(); }
        finally { running = false; scheduleNext(); }
      }
      function scheduleNext(){
        if (document.hidden) return;
        clearTimeout(timer); timer = setTimeout(refreshNow, jitter());
      }

      if (refreshBtn){ refreshBtn.addEventListener('click', ()=>{ clearTimeout(timer); refreshNow(); }); }
      document.addEventListener('visibilitychange', ()=>{ if (document.hidden){ clearTimeout(timer); } else { refreshNow(); } });

      setLastUpdated();
      scheduleNext();
    })();

    /* Initial load */
    runSearch(true);
  </script>
</body>
</html>
