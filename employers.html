<!-- /employer.html ‚Äî Employer Dashboard (Post Jobs, My Posts, Applicants), dark-mode sync, logo scale, mobile-first) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Employer Dashboard ‚Ä¢ CaribCareerHub</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#F3F8FF; --panel:#ffffff; --ink:#0A2458; --muted:#6B7A99;
      --brand:#1E6CFF; --brand-2:#3FA2FF; --accent:#FFA03B;
      --radius:18px; --shadow:0 10px 30px rgba(16,40,120,.12);
      --ring:0 0 0 3px rgba(30,108,255,.14);
      --line: color-mix(in oklab, var(--ink) 12%, transparent);
    }
    body.dark{
      --bg:#0f1525; --panel:#111a2e; --ink:#ecf2ff; --muted:#b7c1d6;
      --brand:#5a8fff; --brand-2:#8ec4ff; --accent:#ffb86c;
      --shadow:0 14px 40px rgba(0,0,0,.45); --ring:0 0 0 3px rgba(142,196,255,.20);
      --line: color-mix(in oklab, var(--ink) 18%, transparent);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      overflow-x:hidden;
    }

    /* Top banner */
    .highlight-banner{
      background:linear-gradient(90deg,var(--brand),var(--brand-2));
      color:#fff; text-align:center; font-weight:800; padding:10px 16px; font-size:14px;
      letter-spacing:.3px; position:sticky; top:0; z-index:10; box-shadow:var(--shadow);
    }

    /* Header */
    .header{
      max-width:1100px; margin:14px auto 0; padding:0 16px;
      display:flex; align-items:center; justify-content:center; gap:12px; position:relative;
    }
    .brand{display:flex; align-items:center; gap:12px; min-width:0}
    .logo{width:min(88px,20vw); height:auto; object-fit:contain}
    .brand-name{font-size:22px; font-weight:900; letter-spacing:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .right-rail{position:absolute; right:16px; top:8px; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .theme-toggle{
      border:1px solid rgba(0,0,0,.08); padding:8px 10px; border-radius:12px;
      background:var(--panel); color:var(--ink); cursor:pointer; font-weight:900;
    }
    body.dark .theme-toggle{ border-color:rgba(255,255,255,.16) }
    .ghost{
      display:inline-block; padding:8px 12px; border-radius:12px; text-decoration:none; font-weight:800;
      background:transparent; color:var(--ink); border:1px solid var(--line);
    }

    /* Layout */
    .wrap{
      max-width:1100px; margin:16px auto 32px; padding:24px; border-radius:var(--radius);
      background:color-mix(in oklab, var(--panel) 90%, transparent); box-shadow:var(--shadow);
      border:1px solid var(--line); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    }
    .dashboard{display:grid; grid-template-columns: 240px 1fr; gap:16px}
    @media (max-width:900px){ .dashboard{grid-template-columns:1fr} }

    /* Sidebar */
    .sidebar{background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:12px}
    .tabs{display:flex; flex-direction:column; gap:8px}
    .tab{display:flex; gap:8px; align-items:center; padding:10px 12px; border-radius:12px; font-weight:800; cursor:pointer; border:1px solid transparent}
    .tab:hover{border-color:var(--line)}
    .tab.active{background: color-mix(in oklab, var(--brand) 18%, transparent); border-color: color-mix(in oklab, var(--brand) 38%, transparent)}
    .tab .i{width:22px; text-align:center}

    /* Main area */
    .main{display:grid; gap:14px}
    .card{background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:18px 20px; box-shadow:var(--shadow)}
    .card h2{margin:0 0 10px; font-size:20px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:640px){ .row{grid-template-columns:1fr} }
    .field label{display:block; font-size:13px; font-weight:900; color:var(--muted); margin-bottom:6px}
    .field input, .field select, .field textarea{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--line);
      background:transparent; color:var(--ink); font:16px/1.4 inherit; outline:none;
    }
    .field textarea{min-height:140px; resize:vertical}
    .field input:focus, .field select:focus, .field textarea:focus{ box-shadow:var(--ring) }

    .btn{ border:none; border-radius:12px; padding:10px 14px; font-weight:900; cursor:pointer }
    .btn-primary{ color:#fff; background:linear-gradient(90deg,var(--brand),var(--brand-2)) }
    .btn-line{ background:transparent; border:1px solid var(--line); color:var(--ink) }

    .list{display:grid; gap:10px}
    .rowline{display:grid; grid-template-columns:1fr auto; gap:10px; align-items:start; padding:12px 14px; border:1px solid var(--line); border-radius:12px}
    .meta{color:var(--muted); font-size:14px}

    .hidden{display:none}
  </style>
</head>
<body>
  <!-- Banner -->
  <div class="highlight-banner">Hire faster with CaribCareerHub ‚Äî post jobs, track applicants, and grow your team.</div>

  <!-- Header -->
  <header class="header">
    <div class="brand">
      <picture>
        <source srcset="./assets/logo.svg" type="image/svg+xml" />
        <img src="./assets/logo.png" alt="CaribCareerHub logo" class="logo" />
      </picture>
      <span class="brand-name">CARRIBCAREERHUB</span>
    </div>
    <div class="right-rail">
      <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">üåô</button>
      <a class="ghost" href="index.html">Home</a>
      <a class="ghost" href="#" id="logoutBtn">Log out</a>
    </div>
  </header>

  <!-- App -->
  <main class="wrap">
    <div class="dashboard">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="tabs">
          <button class="tab active" data-tab="post"><span class="i">‚ûï</span><span>Post a Job</span></button>
          <button class="tab" data-tab="mine"><span class="i">üóÇÔ∏è</span><span>My Posts</span></button>
          <button class="tab" data-tab="apps"><span class="i">üìù</span><span>Applicants</span></button>
          <button class="tab" data-tab="account"><span class="i">‚öôÔ∏è</span><span>Account</span></button>
        </nav>
      </aside>

      <!-- Main -->
      <section class="main">
        <!-- Post a Job -->
        <div id="tab-post" class="card">
          <h2>Post a Job</h2>
          <form id="postForm" class="grid" novalidate>
            <div class="row">
              <div class="field">
                <label>Title</label>
                <input id="pf_title" placeholder="e.g., Frontend Developer" required>
              </div>
              <div class="field">
                <label>Company</label>
                <input id="pf_company" placeholder="e.g., CaribCareerHub" required>
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label>Location</label>
                <input id="pf_location" placeholder="e.g., Kingston, Jamaica">
              </div>
              <div class="field">
                <label>Type</label>
                <select id="pf_type">
                  <option>Full-time</option><option>Part-time</option><option>Remote</option><option>On-site</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label>Salary (optional)</label>
                <input id="pf_salary" placeholder="e.g., JMD 180,000 - 250,000 / mo">
              </div>
              <div class="field">
                <label>Apply Link (optional)</label>
                <input id="pf_apply" placeholder="https://‚Ä¶">
              </div>
            </div>
            <div class="field">
              <label>Description</label>
              <textarea id="pf_desc" placeholder="Brief role overview, responsibilities, requirements‚Ä¶"></textarea>
            </div>
            <div style="display:flex;gap:8px;justify-content:flex-end">
              <button type="reset" class="btn btn-line">Clear</button>
              <button type="submit" class="btn btn-primary" id="postSubmit">Publish</button>
            </div>
            <p id="postMsg" class="meta" role="status"></p>
          </form>
        </div>

        <!-- My Posts -->
        <div id="tab-mine" class="card hidden">
          <h2>My Posts</h2>
          <div id="mineList" class="list"><p class="meta">Loading‚Ä¶</p></div>
        </div>

        <!-- Applicants -->
        <div id="tab-apps" class="card hidden">
          <h2>Applicants</h2>
          <p class="meta">If you save applications in an <code>applications</code> table (job_id, user_id, status, applied_at‚Ä¶), they‚Äôll be listed here.</p>
          <div id="appsList" class="list"><p class="meta">No applicants yet.</p></div>
        </div>

        <!-- Account -->
        <div id="tab-account" class="card hidden">
          <h2>Account</h2>
          <p class="meta">Signed in as <span id="acctEmail">‚Ä¶</span></p>
          <div class="row">
            <div class="field">
              <label>Display Name</label>
              <input id="acctName" placeholder="Your name">
            </div>
            <div class="field">
              <label>Company (profile)</label>
              <input id="acctCompany" placeholder="Company name">
            </div>
          </div>
          <div style="display:flex;gap:8px;justify-content:flex-end">
            <button class="btn btn-primary" id="saveAcct">Save</button>
          </div>
          <p id="acctMsg" class="meta" role="status"></p>
        </div>
      </section>
    </div>
  </main>

  <footer style="max-width:1100px;margin:0 auto 24px;padding:0 16px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;color:var(--muted)">
    <div style="display:flex;gap:18px;flex-wrap:wrap">
      <a href="about.html" style="text-decoration:none;color:inherit;font-weight:900;border-bottom:2px solid transparent;padding-bottom:2px">About</a>
      <a href="contact.html" style="text-decoration:none;color:inherit;font-weight:900;border-bottom:2px solid transparent;padding-bottom:2px">Contact</a>
      <a href="privacy.html" style="text-decoration:none;color:inherit;font-weight:900;border-bottom:2px solid transparent;padding-bottom:2px">Privacy</a>
      <a href="terms.html" style="text-decoration:none;color:inherit;font-weight:900;border-bottom:2px solid transparent;padding-bottom:2px">Terms</a>
    </div>
    <div>¬© 2025 CaribCareerHub</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // === Theme sync (uses shared 'cch.theme') ===
    (function(){
      const saved = localStorage.getItem('cch.theme');
      if (saved === 'dark') document.body.classList.add('dark');
      if (!saved){
        const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefers) document.body.classList.add('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
      }
      const btn = document.getElementById('themeToggle');
      const setIcon = ()=> btn.textContent = document.body.classList.contains('dark') ? 'üåû' : 'üåô';
      setIcon();
      btn.addEventListener('click', ()=>{
        document.body.classList.toggle('dark');
        localStorage.setItem('cch.theme', document.body.classList.contains('dark') ? 'dark':'light');
        setIcon();
      });
    })();

    // === Supabase init (same project as your site) ===
    const SUPABASE_URL = "https://fpytvfhynleaivkvuedt.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZweXR2Zmh5bmxlYWl2a3Z1ZWR0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzU1OTAsImV4cCI6MjA3MTI1MTU5MH0.Q7UHLIA_3_o7zCdV-IOthWOYGVVlINDXjp1uF4sdBRk";
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const LOGIN_PAGE = "login.html";
    const SIGNUP_EMP = "employer-signup.html";

    let currentUser = null;

    // Guard: must be signed in AND role=employer
    (async () => {
      const { data:{ session } } = await sb.auth.getSession();
      if (!session){ window.location.href = LOGIN_PAGE; return; }
      currentUser = session.user;
      const role = (currentUser.user_metadata?.role || '').toLowerCase();
      if (role !== 'employer'){ window.location.href = SIGNUP_EMP; return; }

      // Fill account fields
      document.getElementById('acctEmail').textContent = currentUser.email || "";
      document.getElementById('acctName').value = currentUser.user_metadata?.full_name || "";
      document.getElementById('acctCompany').value = currentUser.user_metadata?.company_name || "";

      // Load my posts
      loadMine();
      // Optional: load applicants if you have a table later
      // loadApplicants();
    })();

    // Tabs
    const tabBtns = Array.from(document.querySelectorAll('.tab'));
    function showTab(id){
      tabBtns.forEach(b => b.classList.toggle('active', b.dataset.tab === id));
      document.querySelectorAll('[id^="tab-"]').forEach(p => p.classList.add('hidden'));
      document.getElementById('tab-' + id).classList.remove('hidden');
      localStorage.setItem('emp.tab', id);
    }
    tabBtns.forEach(b => b.addEventListener('click', ()=> showTab(b.dataset.tab)));
    showTab(localStorage.getItem('emp.tab') || 'post');

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async (e)=>{
      e.preventDefault();
      await sb.auth.signOut();
      window.location.href = LOGIN_PAGE;
    });

    // Post a Job
    const postForm   = document.getElementById('postForm');
    const postMsg    = document.getElementById('postMsg');
    const postSubmit = document.getElementById('postSubmit');

    postForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (!currentUser) return;
      const title = document.getElementById('pf_title').value.trim();
      const company = document.getElementById('pf_company').value.trim();
      const location = document.getElementById('pf_location').value.trim();
      const type = document.getElementById('pf_type').value;
      const salary = document.getElementById('pf_salary').value.trim();
      const apply_url = document.getElementById('pf_apply').value.trim();
      const description = document.getElementById('pf_desc').value.trim();

      if (!title || !company){
        postMsg.textContent = "Please add at least Title and Company.";
        postMsg.className = "meta"; return;
      }
      postSubmit.disabled = true; postMsg.textContent = "Publishing‚Ä¶";

      const { error } = await sb.from('jobs').insert([{
        user_id: currentUser.id, title, company, location, type, salary, apply_url, description
      }]);

      postSubmit.disabled = false;
      if (error){ postMsg.textContent = "‚ùå " + error.message; return; }
      postMsg.textContent = "‚úÖ Posted!";
      postForm.reset();
      loadMine();
      showTab('mine');
    });

    // My Posts
    const mineList = document.getElementById('mineList');

    async function loadMine(){
      if (!currentUser) return;
      mineList.innerHTML = '<p class="meta">Loading‚Ä¶</p>';
      const { data, error } = await sb.from('jobs').select('*').eq('user_id', currentUser.id).order('created_at', { ascending:false });
      if (error){ mineList.innerHTML = '<p class="meta">‚ùå Failed to load.</p>'; return; }
      if (!data || data.length === 0){ mineList.innerHTML = '<p class="meta">You have no posts yet.</p>'; return; }

      mineList.innerHTML = "";
      data.forEach(job => {
        const row = document.createElement('div');
        row.className = 'rowline';
        row.innerHTML = `
          <div>
            <div style="font-weight:900">${escapeHtml(job.title)} <span class="meta">‚Ä¢ ${escapeHtml(job.type||'')}</span></div>
            <div class="meta">${escapeHtml(job.company||'')} ${job.location ? '‚Ä¢ ' + escapeHtml(job.location) : ''} ${job.salary ? '‚Ä¢ ' + escapeHtml(job.salary) : ''}</div>
            <div class="meta">${job.created_at ? new Date(job.created_at).toLocaleString() : ''}</div>
          </div>
          <div style="display:flex; gap:8px">
            <button class="btn btn-line" data-edit="${job.id}">Edit</button>
            <button class="btn btn-primary" data-del="${job.id}" style="background:linear-gradient(90deg,#ff5a5a,#ff7a7a)">Delete</button>
          </div>
        `;
        row.querySelector('[data-del]').addEventListener('click', async ()=>{
          if (!confirm('Delete this post?')) return;
          const { error } = await sb.from('jobs').delete().eq('id', job.id).eq('user_id', currentUser.id);
          if (error) { alert('Delete failed: ' + error.message); return; }
          loadMine();
        });
        row.querySelector('[data-edit]').addEventListener('click', ()=> openEdit(job));
        mineList.appendChild(row);
      });
    }

    function escapeHtml(s){ return (s??'').toString().replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m])); }

    // Inline Edit (simple prompt-based)
    async function openEdit(job){
      const title = prompt('Title', job.title || '') ?? job.title;
      const company = prompt('Company', job.company || '') ?? job.company;
      const location = prompt('Location', job.location || '') ?? job.location;
      const type = prompt('Type (Full-time/Part-time/Remote/On-site)', job.type || '') ?? job.type;
      const salary = prompt('Salary', job.salary || '') ?? job.salary;
      const apply_url = prompt('Apply Link', job.apply_url || '') ?? job.apply_url;
      const description = prompt('Description', job.description || '') ?? job.description;

      const { error } = await sb.from('jobs')
        .update({ title, company, location, type, salary, apply_url, description })
        .eq('id', job.id)
        .eq('user_id', currentUser.id);

      if (error){ alert('Update failed: ' + error.message); return; }
      loadMine();
    }

    // Applicants (optional wire-up if you add table later)
    async function loadApplicants(){
      const appsList = document.getElementById('appsList');
      appsList.innerHTML = '<p class="meta">Loading‚Ä¶</p>';
      const { data, error } = await sb.from('applications')
        .select('*, jobs(title, company)')
        .eq('employer_id', currentUser.id)
        .order('applied_at', { ascending:false });

      if (error){ appsList.innerHTML = '<p class="meta">‚ùå Failed to load.</p>'; return; }
      if (!data || data.length === 0){ appsList.innerHTML = '<p class="meta">No applicants yet.</p>'; return; }
      appsList.innerHTML = '';
      data.forEach(a=>{
        const row = document.createElement('div');
        row.className = 'rowline';
        row.innerHTML = `
          <div>
            <div style="font-weight:900">${escapeHtml(a.candidate_name || a.candidate_email || 'Applicant')}</div>
            <div class="meta">${escapeHtml(a.jobs?.title || 'Job')} ‚Ä¢ ${escapeHtml(a.jobs?.company || '')}</div>
            <div class="meta">${a.applied_at ? new Date(a.applied_at).toLocaleString() : ''}</div>
          </div>
          <div style="display:flex; gap:8px">
            <button class="btn btn-line">View</button>
          </div>
        `;
        appsList.appendChild(row);
      });
    }

    // Account save (updates user metadata)
    document.getElementById('saveAcct').addEventListener('click', async ()=>{
      const name = document.getElementById('acctName').value.trim();
      const company = document.getElementById('acctCompany').value.trim();
      const { error } = await sb.auth.updateUser({ data:{ full_name: name || null, company_name: company || null }});
      const msg = document.getElementById('acctMsg');
      if (error){ msg.textContent = '‚ùå ' + error.message; return; }
      msg.textContent = '‚úÖ Saved.';
    });

    // Live updates: refresh My Posts when table changes
    sb.channel('jobs-updates')
      .on('postgres_changes', { event:'*', schema:'public', table:'jobs' }, () => loadMine())
      .subscribe();
  </script>
</body>
</html>
